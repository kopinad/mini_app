{% load static %}
<html  lang="ru">
    <head>
        <!-- Предзагрузка шрифта -->
        <link rel="preload" href="https://fonts.cdnfonts.com/css/novoposelensky" as="style" onload="this.rel='stylesheet'">

        <noscript>
            <link rel="stylesheet" href="https://fonts.cdnfonts.com/css/novoposelensky">
        </noscript>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Дарья Копина</title>

        <link rel="stylesheet" href="{% static 'css/stylenavig.css' %}">
        <link rel="stylesheet" href="{% static 'css/styleglav.css' %}">
        <link rel="stylesheet" href="{% static 'css/modal.css' %}">
        <link rel="stylesheet" href="{% static 'css/styletab.css' %}">
        <link rel="stylesheet" href="{% static 'css/styleslider.css' %}">
        <link rel="stylesheet" href="{% static 'css/styleform.css' %}">
        <link rel="stylesheet" href="{% static 'css/styleokno.css' %}">
    </head>

    <body>
    <header>
        <div class="navbar">
            <div class="navbar-m">
                <div class="navbar-m1">
                    <a href="{% url 'services:home' %}">Обо мне</a>
                    <a href="{% url 'services:home' %}#uslugi">Услуги</a>
                    <div class="dropdown">
                        <div class="dropbtn">Примеры работ
                            <i class="fa fa-caret-down"></i>
                        </div>
                        <div class="dropdown-content">
                            {% for category in categories %}
                                <a href="{% url 'services:works' category.id %}">{{ category.name }}</a>
                            {% empty %}
                                <a href="#">Категории не найдены</a>
                            {% endfor %}
                        </div>
                    </div>
                    <a href="{% url 'services:home' %}#etaps">Этапы работы</a>
                    <a href="{% url 'services:home' %}#otzivi">Отзывы</a>
                    <a href="{% url 'services:home' %}#contacts">Контакты</a>
                </div>
                <div class="navbar-m1">
                    <a href="{% url 'user:svyaz' %}">Заполнение формы для записи</a>
                </div>
            </div>
        </div>

        <!-- Мобильное меню -->
        <div class="mobile-navbar">
            <div class="mobile-header-container">
                <button class="mobile-menu-btn">☰ Меню</button>
                <a href="{% url 'user:svyaz' %}" class="record-button">Записаться</a>
            </div>

            <div class="mobile-menu-content" id="mobileMenu">
                <a href="{% url 'services:home' %}">Обо мне</a>
                <a href="{% url 'services:home' %}#uslugi">Услуги</a>
                <button class="mobile-dropdown-btn">Примеры работ ▼</button>
                <div class="mobile-dropdown-content">
                    {% for category in categories %}
                        <a href="{% url 'services:works' category.id %}">{{ category.name }}</a>
                    {% endfor %}
                </div>
                <a href="{% url 'services:home' %}#etaps">Этапы работы</a>
                <a href="{% url 'services:home' %}#otzivi">Отзывы</a>
                <a href="{% url 'services:home' %}#contacts">Контакты</a>
            </div>
        </div>
    </header>

    <main>
        <h1>Форма для записи</h1>

        <form method="post" id="serviceForm" class="service-form">
            {% csrf_token %}

            <div class="form-control">
                {{ form.full_name.label_tag }}
                {{ form.full_name }}
            </div>
            <br>

            <div class="form-control">
                {{ form.phone.label_tag }}
                {{ form.phone }}
            </div>
            <br>

            <div class="form-control">
                {{ form.service.label_tag }}
                {{ form.service }}
            </div>
            <br>

            <div class="form-control">
                <label>Где Вам комфортнее продолжать обсуждение заказа?</label>
                <br>
                <div class="form-control">
                    <div class="form-control1">
                    {{ form.contact_whatsapp.label_tag }}
                    {{ form.contact_whatsapp }}
                    </div>
                </div>
                <br>
                <div class="form-control">
                    <div class="form-control1">
                    {{ form.contact_telegram.label_tag }}
                    {{ form.contact_telegram }}
                    </div>
                </div>
            </div>
            <br>

            <div class="bt">
                <button type="submit" class="btn btn-primary" name="run_script">Отправить</button>
            </div>
        </form>

        <div id="openModal" class="modal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <a href="#" title="Close" class="close" onclick="closeModal()">×</a>
                    </div>
                    <div class="modal-body">
                        <div class="dialog">Спасибо! Ваши данные сохранены, скоро с Вами свяжутся!</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer id="contacts">
        <div class="flex-container">
            {% load static %}
            <div class="flex-item-footer">
                <div class="flex-icons-footer"><img src="{% static 'IMG/icons/Telegram.png' %}" alt="Telegram" loading="lazy"></div>
                <div class="flex-icons-footer">
                    <div class="h3">Telegram:</div>
                    <p>@aaaaaaa</p>
                </div>
            </div>
            <div class="flex-item-footer">
                <div class="flex-icons-footer"><img src="{% static 'IMG/icons/Mobile.png' %}" alt="Mobile" loading="lazy"></div>
                <div class="flex-icons-footer">
                    <div class="h3">Mobile:</div>
                    <p>8 999 999 99 99</p>
                </div>
            </div>
            <div class="flex-item-footer">
                <div class="flex-icons-footer"><img src="{% static 'IMG/icons/Instagram.png' %}" alt="Instagram" loading="lazy"></div>
                <div class="flex-icons-footer">
                    <div class="h3">Instagram*:</div>
                    <p>@aaaaaaa</p>
                </div>
            </div>
            <div class="flex-item-footer">
                <div class="flex-icons-footer"><img src="{% static 'IMG/icons/Mail.png' %}" alt="Mail" loading="lazy"></div>
                <div class="flex-icons-footer">
                    <div class="h3">Mail:</div>
                    <p>aaaaaaaaa@gmail.com</p>
                </div>
            </div>
        </div>
        <div class="p1">Instagram* - запрещенная соц. сеть на территории РФ</div>
        </footer>

        {% if submitted %}
        <script>


            document.getElementById('serviceForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const form = e.target;
                const formData = new FormData(form);
                const submitBtn = form.querySelector('button[type="submit"]');

                submitBtn.disabled = true;
                submitBtn.textContent = 'Отправка...';

                fetch("{% url 'user:form_submit' %}", {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        document.getElementById('openModal').classList.add('show');
                        form.reset();
                    } else {
                        alert(data.message || 'Ошибка отправки формы');
                    }
                })
                .catch(error => {
                    alert('Произошла ошибка: ' + error.message);
                })
                .finally(() => {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Отправить';
                });
            });

            function closeModal() {
                document.getElementById('openModal').classList.remove('show');
            }

            document.addEventListener('DOMContentLoaded', function() {
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.has('submitted')) {
                    document.getElementById('openModal').classList.add('show');
                }
            });
        </script>
        {% endif %}
    </body>

    <script src="{% static 'js/menuphone.js' %}"></script>
    <script src="{% static 'js/modal.js' %}"></script>
    <script src="{% static 'js/slider.js' %}"></script>
    <script src="{% static 'js/tab.js' %}"></script>
</html>